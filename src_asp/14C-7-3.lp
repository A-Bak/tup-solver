limit_big(7).  limit_small(3).
team(1..14).  umpire(1..7).
round(1..26).  last(26).

distance(1, 1, 0). distance(1, 2, 253). distance(1, 3, 410). distance(1, 4, 557). distance(1, 5, 451). distance(1, 6, 1140). distance(1, 7, 1320). distance(1, 8, 2260). distance(1, 9, 2110). distance(1, 10, 521). distance(1, 11, 315). distance(1, 12, 257). distance(1, 13, 408). distance(1, 14, 1010).
distance(2, 1, 253). distance(2, 2, 0). distance(2, 3, 250). distance(2, 4, 311). distance(2, 5, 325). distance(2, 6, 897). distance(2, 7, 1090). distance(2, 8, 2040). distance(2, 9, 1870). distance(2, 10, 370). distance(2, 11, 567). distance(2, 12, 501). distance(2, 13, 622). distance(2, 14, 957).
distance(3, 1, 410). distance(3, 2, 250). distance(3, 3, 0). distance(3, 4, 260). distance(3, 5, 86). distance(3, 6, 939). distance(3, 7, 916). distance(3, 8, 1850). distance(3, 9, 1730). distance(3, 10, 587). distance(3, 11, 712). distance(3, 12, 664). distance(3, 13, 646). distance(3, 14, 1190).
distance(4, 1, 557). distance(4, 2, 311). distance(4, 3, 260). distance(4, 4, 0). distance(4, 5, 328). distance(4, 6, 679). distance(4, 7, 794). distance(4, 8, 1740). distance(4, 9, 1560). distance(4, 10, 467). distance(4, 11, 871). distance(4, 12, 808). distance(4, 13, 878). distance(4, 14, 1060).
distance(5, 1, 451). distance(5, 2, 325). distance(5, 3, 86). distance(5, 4, 328). distance(5, 5, 0). distance(5, 6, 1005). distance(5, 7, 905). distance(5, 8, 1846). distance(5, 9, 1731). distance(5, 10, 670). distance(5, 11, 741). distance(5, 12, 697). distance(5, 13, 732). distance(5, 14, 1270).
distance(6, 1, 1140). distance(6, 2, 897). distance(6, 3, 939). distance(6, 4, 679). distance(6, 5, 1005). distance(6, 6, 0). distance(6, 7, 878). distance(6, 8, 1640). distance(6, 9, 1300). distance(6, 10, 700). distance(6, 11, 1420). distance(6, 12, 1340). distance(6, 13, 1520). distance(6, 14, 966).
distance(7, 1, 1320). distance(7, 2, 1090). distance(7, 3, 916). distance(7, 4, 794). distance(7, 5, 905). distance(7, 6, 878). distance(7, 7, 0). distance(7, 8, 947). distance(7, 9, 832). distance(7, 10, 1210). distance(7, 11, 1630). distance(7, 12, 1570). distance(7, 13, 1530). distance(7, 14, 1720).
distance(8, 1, 2260). distance(8, 2, 2040). distance(8, 3, 1850). distance(8, 4, 1740). distance(8, 5, 1846). distance(8, 6, 1640). distance(8, 7, 947). distance(8, 8, 0). distance(8, 9, 458). distance(8, 10, 2130). distance(8, 11, 2560). distance(8, 12, 2520). distance(8, 13, 2430). distance(8, 14, 2590).
distance(9, 1, 2110). distance(9, 2, 1870). distance(9, 3, 1730). distance(9, 4, 1560). distance(9, 5, 1731). distance(9, 6, 1300). distance(9, 7, 832). distance(9, 8, 458). distance(9, 9, 0). distance(9, 10, 1890). distance(9, 11, 2430). distance(9, 12, 2370). distance(9, 13, 2360). distance(9, 14, 2270).
distance(10, 1, 521). distance(10, 2, 370). distance(10, 3, 587). distance(10, 4, 467). distance(10, 5, 670). distance(10, 6, 700). distance(10, 7, 1210). distance(10, 8, 2130). distance(10, 9, 1890). distance(10, 10, 0). distance(10, 11, 745). distance(10, 12, 665). distance(10, 13, 929). distance(10, 14, 605).
distance(11, 1, 315). distance(11, 2, 567). distance(11, 3, 712). distance(11, 4, 871). distance(11, 5, 741). distance(11, 6, 1420). distance(11, 7, 1630). distance(11, 8, 2560). distance(11, 9, 2430). distance(11, 10, 745). distance(11, 11, 0). distance(11, 12, 80). distance(11, 13, 337). distance(11, 14, 1090).
distance(12, 1, 257). distance(12, 2, 501). distance(12, 3, 664). distance(12, 4, 808). distance(12, 5, 697). distance(12, 6, 1340). distance(12, 7, 1570). distance(12, 8, 2520). distance(12, 9, 2370). distance(12, 10, 665). distance(12, 11, 80). distance(12, 12, 0). distance(12, 13, 380). distance(12, 14, 1020).
distance(13, 1, 408). distance(13, 2, 622). distance(13, 3, 646). distance(13, 4, 878). distance(13, 5, 732). distance(13, 6, 1520). distance(13, 7, 1530). distance(13, 8, 2430). distance(13, 9, 2360). distance(13, 10, 929). distance(13, 11, 337). distance(13, 12, 380). distance(13, 13, 0). distance(13, 14, 1380).
distance(14, 1, 1010). distance(14, 2, 957). distance(14, 3, 1190). distance(14, 4, 1060). distance(14, 5, 1270). distance(14, 6, 966). distance(14, 7, 1720). distance(14, 8, 2590). distance(14, 9, 2270). distance(14, 10, 605). distance(14, 11, 1090). distance(14, 12, 1020). distance(14, 13, 1380). distance(14, 14, 0).
distance(X,Y,D) :- distance(Y,X,D).
max_distance(2590).

plays(1, 2, 1). plays(4, 8, 1). plays(5, 7, 1). plays(9, 10, 1). plays(11, 3, 1). plays(12, 6, 1). plays(13, 14, 1).
plays(5, 2, 2). plays(7, 4, 2). plays(8, 10, 2). plays(9, 1, 2). plays(11, 12, 2). plays(13, 6, 2). plays(14, 3, 2).
plays(2, 7, 3). plays(5, 11, 3). plays(8, 4, 3). plays(10, 1, 3). plays(12, 9, 3). plays(13, 3, 3). plays(14, 6, 3).
plays(2, 5, 4). plays(3, 7, 4). plays(6, 11, 4). plays(8, 1, 4). plays(10, 4, 4). plays(12, 13, 4). plays(14, 9, 4).
plays(1, 14, 5). plays(2, 3, 5). plays(4, 5, 5). plays(6, 13, 5). plays(7, 11, 5). plays(9, 12, 5). plays(10, 8, 5).
plays(1, 7, 6). plays(3, 4, 6). plays(5, 14, 6). plays(8, 6, 6). plays(9, 13, 6). plays(11, 2, 6). plays(12, 10, 6).
plays(1, 3, 7). plays(6, 4, 7). plays(7, 2, 7). plays(9, 8, 7). plays(11, 5, 7). plays(12, 14, 7). plays(13, 10, 7).
plays(4, 11, 8). plays(6, 1, 8). plays(7, 9, 8). plays(8, 2, 8). plays(12, 3, 8). plays(13, 5, 8). plays(14, 10, 8).
plays(1, 9, 9). plays(2, 11, 9). plays(4, 6, 9). plays(7, 8, 9). plays(10, 3, 9). plays(13, 12, 9). plays(14, 5, 9).
plays(2, 8, 10). plays(3, 11, 10). plays(4, 1, 10). plays(5, 9, 10). plays(6, 7, 10). plays(10, 13, 10). plays(14, 12, 10).
plays(2, 1, 11). plays(3, 6, 11). plays(8, 13, 11). plays(9, 4, 11). plays(10, 14, 11). plays(11, 7, 11). plays(12, 5, 11).
plays(3, 1, 12). plays(4, 14, 12). plays(6, 10, 12). plays(7, 13, 12). plays(8, 11, 12). plays(9, 5, 12). plays(12, 2, 12).
plays(1, 5, 13). plays(4, 12, 13). plays(6, 9, 13). plays(7, 3, 13). plays(8, 14, 13). plays(10, 11, 13). plays(13, 2, 13).
plays(1, 8, 14). plays(3, 12, 14). plays(4, 7, 14). plays(5, 6, 14). plays(10, 9, 14). plays(11, 13, 14). plays(14, 2, 14).
plays(1, 13, 15). plays(2, 4, 15). plays(3, 10, 15). plays(5, 8, 15). plays(7, 12, 15). plays(9, 6, 15). plays(11, 14, 15).
plays(2, 10, 16). plays(4, 3, 16). plays(5, 13, 16). plays(7, 6, 16). plays(9, 14, 16). plays(11, 8, 16). plays(12, 1, 16).
plays(3, 5, 17). plays(4, 10, 17). plays(6, 2, 17). plays(7, 14, 17). plays(8, 9, 17). plays(12, 11, 17). plays(13, 1, 17).
plays(3, 8, 18). plays(6, 5, 18). plays(9, 2, 18). plays(10, 7, 18). plays(12, 4, 18). plays(13, 11, 18). plays(14, 1, 18).
plays(1, 12, 19). plays(6, 8, 19). plays(7, 5, 19). plays(9, 3, 19). plays(10, 2, 19). plays(13, 4, 19). plays(14, 11, 19).
plays(2, 13, 20). plays(5, 12, 20). plays(8, 3, 20). plays(9, 7, 20). plays(10, 6, 20). plays(11, 1, 20). plays(14, 4, 20).
plays(2, 14, 21). plays(3, 13, 21). plays(4, 9, 21). plays(5, 10, 21). plays(7, 1, 21). plays(8, 12, 21). plays(11, 6, 21).
plays(1, 6, 22). plays(2, 9, 22). plays(3, 14, 22). plays(4, 13, 22). plays(8, 5, 22). plays(11, 10, 22). plays(12, 7, 22).
plays(1, 11, 23). plays(3, 9, 23). plays(4, 2, 23). plays(6, 14, 23). plays(10, 5, 23). plays(12, 8, 23). plays(13, 7, 23).
plays(1, 4, 24). plays(2, 6, 24). plays(5, 3, 24). plays(9, 11, 24). plays(10, 12, 24). plays(13, 8, 24). plays(14, 7, 24).
plays(2, 12, 25). plays(5, 1, 25). plays(6, 3, 25). plays(7, 10, 25). plays(11, 4, 25). plays(13, 9, 25). plays(14, 8, 25).
plays(1, 10, 26). plays(3, 2, 26). plays(5, 4, 26). plays(6, 12, 26). plays(8, 7, 26). plays(11, 9, 26). plays(14, 13, 26).

% Defines home team as the first of the two teams.
home_team(Home,R) :- plays(Home,Away,R).

% Generating search space, Umpire X moves to the home venue of team Y in round T
% Constrains the umpires movement to 1 move per round
1 { move(X,Y,T) : home_team(Y,T) } 1 :- umpire(X), round(T).

% Constrains the maximum number of umpires at a game to 1
:- move(U1,T,R), move(U2,T,R), U1 != U2.

% Constrains the minimum number of umpires at a game to 1
:- home_team(T,R), round(R), { move(U,T,R) : umpire(U) } 0.

% Express constrain that every umpire must visit each venue at least once
been_to(U,T) :- round(R), move(U,T,R).
:- umpire(U), team(T), not been_to(U,T).

% Express the constraint d1
:- move(U,T,R1), move(U,T,R2), R1 < R2, limit_big(B), R2 - R1 + 1 <= B.

% Express the constraint d2
officiates(U,Home,R) :- move(U,Home,R).
officiates(U,Away,R) :- move(U,Home,R), plays(Home,Away,R).
:- officiates(U,T,R1), officiates(U,T,R2), R1 < R2, limit_small(S), R2 - R1 + 1 <= S.

moved(U,R,D) :- umpire(U), team(T), round(R), R > 1, move(U,T,R), move(U,Tp,R-1), distance(T,Tp,D).

% Optimization objective - Minimize distance D traveled
#minimize { D,U,R : moved(U,R,D) }.

#heuristic move(U,T,R) : round(R), team(T), umpire(U), not been_to(U,T), move(U,T1,R-1), distance(T,T1,D). [-R*D@2, level]
#heuristic move(U,T,R) : round(R), team(T), umpire(U), move(U,T1,R-1), distance(T,T1,D). [-D@1, level]



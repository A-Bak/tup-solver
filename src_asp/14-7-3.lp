limit_big(7).  limit_small(3).
team(1..14).  umpire(1..7).
round(1..26).  last(26).

distance(1, 1, 0). distance(1, 2, 745). distance(1, 3, 665). distance(1, 4, 929). distance(1, 5, 605). distance(1, 6, 521). distance(1, 7, 370). distance(1, 8, 587). distance(1, 9, 467). distance(1, 10, 670). distance(1, 11, 700). distance(1, 12, 1210). distance(1, 13, 2130). distance(1, 14, 1890).
distance(2, 1, 745). distance(2, 2, 0). distance(2, 3, 80). distance(2, 4, 337). distance(2, 5, 1090). distance(2, 6, 315). distance(2, 7, 567). distance(2, 8, 712). distance(2, 9, 871). distance(2, 10, 741). distance(2, 11, 1420). distance(2, 12, 1630). distance(2, 13, 2560). distance(2, 14, 2430).
distance(3, 1, 665). distance(3, 2, 80). distance(3, 3, 0). distance(3, 4, 380). distance(3, 5, 1020). distance(3, 6, 257). distance(3, 7, 501). distance(3, 8, 664). distance(3, 9, 808). distance(3, 10, 697). distance(3, 11, 1340). distance(3, 12, 1570). distance(3, 13, 2520). distance(3, 14, 2370).
distance(4, 1, 929). distance(4, 2, 337). distance(4, 3, 380). distance(4, 4, 0). distance(4, 5, 1380). distance(4, 6, 408). distance(4, 7, 622). distance(4, 8, 646). distance(4, 9, 878). distance(4, 10, 732). distance(4, 11, 1520). distance(4, 12, 1530). distance(4, 13, 2430). distance(4, 14, 2360).
distance(5, 1, 605). distance(5, 2, 1090). distance(5, 3, 1020). distance(5, 4, 1380). distance(5, 5, 0). distance(5, 6, 1010). distance(5, 7, 957). distance(5, 8, 1190). distance(5, 9, 1060). distance(5, 10, 1270). distance(5, 11, 966). distance(5, 12, 1720). distance(5, 13, 2590). distance(5, 14, 2270).
distance(6, 1, 521). distance(6, 2, 315). distance(6, 3, 257). distance(6, 4, 408). distance(6, 5, 1010). distance(6, 6, 0). distance(6, 7, 253). distance(6, 8, 410). distance(6, 9, 557). distance(6, 10, 451). distance(6, 11, 1140). distance(6, 12, 1320). distance(6, 13, 2260). distance(6, 14, 2110).
distance(7, 1, 370). distance(7, 2, 567). distance(7, 3, 501). distance(7, 4, 622). distance(7, 5, 957). distance(7, 6, 253). distance(7, 7, 0). distance(7, 8, 250). distance(7, 9, 311). distance(7, 10, 325). distance(7, 11, 897). distance(7, 12, 1090). distance(7, 13, 2040). distance(7, 14, 1870).
distance(8, 1, 587). distance(8, 2, 712). distance(8, 3, 664). distance(8, 4, 646). distance(8, 5, 1190). distance(8, 6, 410). distance(8, 7, 250). distance(8, 8, 0). distance(8, 9, 260). distance(8, 10, 86). distance(8, 11, 939). distance(8, 12, 916). distance(8, 13, 1850). distance(8, 14, 1730).
distance(9, 1, 467). distance(9, 2, 871). distance(9, 3, 808). distance(9, 4, 878). distance(9, 5, 1060). distance(9, 6, 557). distance(9, 7, 311). distance(9, 8, 260). distance(9, 9, 0). distance(9, 10, 328). distance(9, 11, 679). distance(9, 12, 794). distance(9, 13, 1740). distance(9, 14, 1560).
distance(10, 1, 670). distance(10, 2, 741). distance(10, 3, 697). distance(10, 4, 732). distance(10, 5, 1270). distance(10, 6, 451). distance(10, 7, 325). distance(10, 8, 86). distance(10, 9, 328). distance(10, 10, 0). distance(10, 11, 1005). distance(10, 12, 905). distance(10, 13, 1846). distance(10, 14, 1731).
distance(11, 1, 700). distance(11, 2, 1420). distance(11, 3, 1340). distance(11, 4, 1520). distance(11, 5, 966). distance(11, 6, 1140). distance(11, 7, 897). distance(11, 8, 939). distance(11, 9, 679). distance(11, 10, 1005). distance(11, 11, 0). distance(11, 12, 878). distance(11, 13, 1640). distance(11, 14, 1300).
distance(12, 1, 1210). distance(12, 2, 1630). distance(12, 3, 1570). distance(12, 4, 1530). distance(12, 5, 1720). distance(12, 6, 1320). distance(12, 7, 1090). distance(12, 8, 916). distance(12, 9, 794). distance(12, 10, 905). distance(12, 11, 878). distance(12, 12, 0). distance(12, 13, 947). distance(12, 14, 832).
distance(13, 1, 2130). distance(13, 2, 2560). distance(13, 3, 2520). distance(13, 4, 2430). distance(13, 5, 2590). distance(13, 6, 2260). distance(13, 7, 2040). distance(13, 8, 1850). distance(13, 9, 1740). distance(13, 10, 1846). distance(13, 11, 1640). distance(13, 12, 947). distance(13, 13, 0). distance(13, 14, 458).
distance(14, 1, 1890). distance(14, 2, 2430). distance(14, 3, 2370). distance(14, 4, 2360). distance(14, 5, 2270). distance(14, 6, 2110). distance(14, 7, 1870). distance(14, 8, 1730). distance(14, 9, 1560). distance(14, 10, 1731). distance(14, 11, 1300). distance(14, 12, 832). distance(14, 13, 458). distance(14, 14, 0).
distance(X,Y,D) :- distance(Y,X,D).
max_distance(2590).

plays(1, 2, 1). plays(4, 8, 1). plays(5, 7, 1). plays(9, 10, 1). plays(11, 3, 1). plays(12, 6, 1). plays(13, 14, 1).
plays(5, 2, 2). plays(7, 4, 2). plays(8, 10, 2). plays(9, 1, 2). plays(11, 12, 2). plays(13, 6, 2). plays(14, 3, 2).
plays(2, 7, 3). plays(5, 11, 3). plays(8, 4, 3). plays(10, 1, 3). plays(12, 9, 3). plays(13, 3, 3). plays(14, 6, 3).
plays(2, 5, 4). plays(3, 7, 4). plays(6, 11, 4). plays(8, 1, 4). plays(10, 4, 4). plays(12, 13, 4). plays(14, 9, 4).
plays(1, 14, 5). plays(2, 3, 5). plays(4, 5, 5). plays(6, 13, 5). plays(7, 11, 5). plays(9, 12, 5). plays(10, 8, 5).
plays(1, 7, 6). plays(3, 4, 6). plays(5, 14, 6). plays(8, 6, 6). plays(9, 13, 6). plays(11, 2, 6). plays(12, 10, 6).
plays(1, 3, 7). plays(6, 4, 7). plays(7, 2, 7). plays(9, 8, 7). plays(11, 5, 7). plays(12, 14, 7). plays(13, 10, 7).
plays(4, 11, 8). plays(6, 1, 8). plays(7, 9, 8). plays(8, 2, 8). plays(12, 3, 8). plays(13, 5, 8). plays(14, 10, 8).
plays(1, 9, 9). plays(2, 11, 9). plays(4, 6, 9). plays(7, 8, 9). plays(10, 3, 9). plays(13, 12, 9). plays(14, 5, 9).
plays(2, 8, 10). plays(3, 11, 10). plays(4, 1, 10). plays(5, 9, 10). plays(6, 7, 10). plays(10, 13, 10). plays(14, 12, 10).
plays(2, 1, 11). plays(3, 6, 11). plays(8, 13, 11). plays(9, 4, 11). plays(10, 14, 11). plays(11, 7, 11). plays(12, 5, 11).
plays(3, 1, 12). plays(4, 14, 12). plays(6, 10, 12). plays(7, 13, 12). plays(8, 11, 12). plays(9, 5, 12). plays(12, 2, 12).
plays(1, 5, 13). plays(4, 12, 13). plays(6, 9, 13). plays(7, 3, 13). plays(8, 14, 13). plays(10, 11, 13). plays(13, 2, 13).
plays(1, 8, 14). plays(3, 12, 14). plays(4, 7, 14). plays(5, 6, 14). plays(10, 9, 14). plays(11, 13, 14). plays(14, 2, 14).
plays(1, 13, 15). plays(2, 4, 15). plays(3, 10, 15). plays(5, 8, 15). plays(7, 12, 15). plays(9, 6, 15). plays(11, 14, 15).
plays(2, 10, 16). plays(4, 3, 16). plays(5, 13, 16). plays(7, 6, 16). plays(9, 14, 16). plays(11, 8, 16). plays(12, 1, 16).
plays(3, 5, 17). plays(4, 10, 17). plays(6, 2, 17). plays(7, 14, 17). plays(8, 9, 17). plays(12, 11, 17). plays(13, 1, 17).
plays(3, 8, 18). plays(6, 5, 18). plays(9, 2, 18). plays(10, 7, 18). plays(12, 4, 18). plays(13, 11, 18). plays(14, 1, 18).
plays(1, 12, 19). plays(6, 8, 19). plays(7, 5, 19). plays(9, 3, 19). plays(10, 2, 19). plays(13, 4, 19). plays(14, 11, 19).
plays(2, 13, 20). plays(5, 12, 20). plays(8, 3, 20). plays(9, 7, 20). plays(10, 6, 20). plays(11, 1, 20). plays(14, 4, 20).
plays(2, 14, 21). plays(3, 13, 21). plays(4, 9, 21). plays(5, 10, 21). plays(7, 1, 21). plays(8, 12, 21). plays(11, 6, 21).
plays(1, 6, 22). plays(2, 9, 22). plays(3, 14, 22). plays(4, 13, 22). plays(8, 5, 22). plays(11, 10, 22). plays(12, 7, 22).
plays(1, 11, 23). plays(3, 9, 23). plays(4, 2, 23). plays(6, 14, 23). plays(10, 5, 23). plays(12, 8, 23). plays(13, 7, 23).
plays(1, 4, 24). plays(2, 6, 24). plays(5, 3, 24). plays(9, 11, 24). plays(10, 12, 24). plays(13, 8, 24). plays(14, 7, 24).
plays(2, 12, 25). plays(5, 1, 25). plays(6, 3, 25). plays(7, 10, 25). plays(11, 4, 25). plays(13, 9, 25). plays(14, 8, 25).
plays(1, 10, 26). plays(3, 2, 26). plays(5, 4, 26). plays(6, 12, 26). plays(8, 7, 26). plays(11, 9, 26). plays(14, 13, 26).

% Defines home team as the first of the two teams.
home_team(Home,R) :- plays(Home,Away,R).

% Generating search space, Umpire X moves to the home venue of team Y in round T
% Constrains the umpires movement to 1 move per round
1 { move(X,Y,T) : home_team(Y,T) } 1 :- umpire(X), round(T).

% Constrains the maximum number of umpires at a game to 1
:- move(U1,T,R), move(U2,T,R), U1 != U2.

% Constrains the minimum number of umpires at a game to 1
:- home_team(T,R), round(R), { move(U,T,R) : umpire(U) } 0.

% Express constrain that every umpire must visit each venue at least once
been_to(U,T) :- round(R), move(U,T,R).
:- umpire(U), team(T), not been_to(U,T).

% Express the constraint d1
:- move(U,T,R1), move(U,T,R2), R1 < R2, limit_big(B), R2 - R1 + 1 <= B.

% Express the constraint d2
officiates(U,Home,R) :- move(U,Home,R).
officiates(U,Away,R) :- move(U,Home,R), plays(Home,Away,R).
:- officiates(U,T,R1), officiates(U,T,R2), R1 < R2, limit_small(S), R2 - R1 + 1 <= S.

moved(U,R,D) :- umpire(U), team(T), round(R), R > 1, move(U,T,R), move(U,Tp,R-1), distance(T,Tp,D).

% Optimization objective - Minimize distance D traveled
#minimize { D,U,R : moved(U,R,D) }.

#heuristic move(U,T,R) : round(R), team(T), umpire(U), not been_to(U,T), move(U,T1,R-1), distance(T,T1,D). [-R*D@2, level]
#heuristic move(U,T,R) : round(R), team(T), umpire(U), move(U,T1,R-1), distance(T,T1,D). [-D@1, level]


